<Window x:Class="PrettyScreenSHOT.ScreenshotHistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PrettyScreenSHOT"
        Title="Screenshot History" Height="650" Width="720" WindowStartupLocation="CenterScreen"
        Background="Transparent" Foreground="{StaticResource NeumorphicTextBrush}"
        WindowStyle="None" AllowsTransparency="True">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/PrettyScreenSHOT;component/NeumorphicStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- Converter dla Visibility -->
            <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        </ResourceDictionary>
    </Window.Resources>

    <!-- Neumorphic window chrome -->
    <Border Style="{StaticResource NeumorphicPanel}" CornerRadius="18" Margin="15" Padding="0">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/> <!-- Title bar -->
                <RowDefinition Height="*"/>  <!-- Main content -->
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0" Background="Transparent" Padding="15,10" CornerRadius="18,18,0,0"
                    MouseLeftButtonDown="OnTitleBarMouseDown">
                <DockPanel>
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                        <TextBlock Text="ðŸ“¸" FontSize="24" Margin="0,0,10,0"/>
                        <TextBlock Text="Screenshot History" FontSize="20"
                                   Style="{StaticResource NeumorphicHeading}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <Button Click="OnCloseClick" Style="{StaticResource NeumorphicCircularButton}"
                            Width="32" Height="32" DockPanel.Dock="Right"
                            HorizontalAlignment="Right" ToolTip="Zamknij">
                        <TextBlock Text="âœ•" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>
                </DockPanel>
            </Border>

            <!-- Main Content -->
            <Grid Grid.Row="1" Margin="20,10,20,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Search/Filter -->
                    <RowDefinition Height="*"/>    <!-- History List -->
                </Grid.RowDefinitions>

                <!-- Search and Filter -->
                <Grid Grid.Row="0" Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Search Box -->
                    <TextBox x:Name="SearchTextBox" Grid.Column="0"
                            Style="{StaticResource NeumorphicTextBox}"
                            Padding="10,8" Margin="0,0,10,0"
                            TextChanged="OnSearchTextChanged"/>

                    <!-- Category Filter -->
                    <ComboBox x:Name="CategoryComboBox" Grid.Column="1"
                             Style="{StaticResource NeumorphicComboBox}"
                             Margin="0,0,10,0"
                             SelectionChanged="OnCategoryChanged">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Style="{StaticResource NeumorphicTextBlock}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <!-- Clear Filters -->
                    <Button x:Name="ClearFiltersButton" Grid.Column="2"
                           Content="Clear" Click="OnClearFiltersClick"
                           Style="{StaticResource NeumorphicRaisedButton}"/>
                </Grid>

                <!-- History List -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="HistoryListBox" ItemsSource="{Binding}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource NeumorphicRaisedBorder}" Margin="0,0,0,10" Padding="15">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Thumbnail -->
                                        <Border Grid.Column="0" Width="100" Height="75" CornerRadius="8"
                                                Margin="0,0,15,0" VerticalAlignment="Center">
                                            <Border.Background>
                                                <ImageBrush ImageSource="{Binding Thumbnail}" Stretch="UniformToFill"/>
                                            </Border.Background>
                                        </Border>

                                        <!-- Info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Filename}"
                                                       Style="{StaticResource NeumorphicTextBlock}"
                                                       FontWeight="Regular" FontSize="14"/>
                                            <TextBlock Text="{Binding Timestamp, StringFormat='dd.MM.yyyy HH:mm:ss'}"
                                                       Style="{StaticResource NeumorphicTextBlockSecondary}"
                                                       Margin="0,5,0,0"/>

                                            <!-- Cloud URL -->
                                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0"
                                                       Visibility="{Binding CloudUrl, Converter={StaticResource NullToVisibilityConverter}}">
                                                <TextBlock Text="â˜" FontSize="12"
                                                          Style="{StaticResource NeumorphicTextBlockSecondary}"
                                                          Margin="0,0,5,0"/>
                                                <TextBlock Text="{Binding CloudProvider}"
                                                          Style="{StaticResource NeumorphicTextBlockSecondary}"
                                                          Margin="0,0,5,0"/>
                                                <Button Click="OnCloudUrlClick"
                                                       Style="{StaticResource NeumorphicRaisedButton}"
                                                       Padding="4,2" Cursor="Hand">
                                                    <TextBlock Text="{Binding CloudUrl}"
                                                              Style="{StaticResource NeumorphicTextBlockSecondary}"
                                                              TextDecorations="Underline"
                                                              TextTrimming="CharacterEllipsis" MaxWidth="200"/>
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Action Buttons -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0,0,0">
                                            <!-- Upload Button (if not uploaded) -->
                                            <Button Click="OnUploadClick"
                                                   Style="{StaticResource NeumorphicRaisedButton}"
                                                   Padding="10,6" Margin="0,0,5,0"
                                                   Visibility="{Binding CloudUrl, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                                                <TextBlock Text="Upload" Style="{StaticResource NeumorphicTextBlock}"/>
                                            </Button>

                                            <!-- Delete Button -->
                                            <Button Click="OnDeleteClick"
                                                   Style="{StaticResource NeumorphicCircularButton}"
                                                   Width="36" Height="36"
                                                   ToolTip="Delete">
                                                <TextBlock Text="ðŸ—‘" FontSize="16"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Border>
</Window>
