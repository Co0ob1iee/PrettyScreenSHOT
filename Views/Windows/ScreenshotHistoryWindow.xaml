<ui:FluentWindow x:Class="PrettyScreenSHOT.Views.Windows.ScreenshotHistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:local="clr-namespace:PrettyScreenSHOT.Views.Windows"
        xmlns:helpers="clr-namespace:PrettyScreenSHOT.Helpers"
        xmlns:converters="clr-namespace:PrettyScreenSHOT.Converters"
        Title="Screenshot History"
        Height="650"
        Width="720"
        WindowStartupLocation="CenterScreen"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        WindowCornerPreference="Round">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Title bar -->
            <RowDefinition Height="*"/>    <!-- Main content -->
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0"
                     Title="Screenshot History"
                     Icon="pack://application:,,,/app.ico"/>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Search/Filter -->
                <RowDefinition Height="*"/>    <!-- History List -->
            </Grid.RowDefinitions>

            <!-- Search and Filter Card -->
            <ui:Card Grid.Row="0" Margin="0,0,0,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Search Box -->
                    <ui:TextBox x:Name="SearchTextBox"
                                Grid.Column="0"
                                Icon="Search24"
                                PlaceholderText="Search screenshots..."
                                Margin="0,0,8,0"
                                TextChanged="OnSearchTextChanged"/>

                    <!-- Category Filter -->
                    <ComboBox x:Name="CategoryComboBox"
                              Grid.Column="1"
                              Margin="0,0,8,0"
                              SelectionChanged="OnCategoryChanged"/>

                    <!-- Clear Filters -->
                    <ui:Button x:Name="ClearFiltersButton"
                               Grid.Column="2"
                               Content="Clear"
                               Click="OnClearFiltersClick"
                               Icon="Dismiss24"/>
                </Grid>
            </ui:Card>

            <!-- History List -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="HistoryListBox" ItemsSource="{Binding}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <ui:Card Margin="0,0,0,12" Padding="16">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Thumbnail -->
                                    <Border Grid.Column="0"
                                            Width="100"
                                            Height="75"
                                            CornerRadius="8"
                                            Margin="0,0,16,0"
                                            VerticalAlignment="Center"
                                            ClipToBounds="True">
                                        <Border.Background>
                                            <ImageBrush ImageSource="{Binding Thumbnail}"
                                                        Stretch="UniformToFill"/>
                                        </Border.Background>
                                    </Border>

                                    <!-- Info -->
                                    <StackPanel Grid.Column="1"
                                                VerticalAlignment="Center"
                                                helpers:StackPanelHelper.Spacing="4">
                                        <TextBlock Text="{Binding Filename}"
                                                   FontWeight="Medium"
                                                   FontSize="14"/>
                                        <TextBlock Text="{Binding Timestamp, StringFormat='dd.MM.yyyy HH:mm:ss'}"
                                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                   FontSize="12"/>

                                        <!-- Cloud URL -->
                                        <StackPanel Orientation="Horizontal"
                                                    Margin="0,4,0,0"
                                                    Visibility="{Binding CloudUrl, Converter={StaticResource NullToVisibilityConverter}}">
                                            <ui:SymbolIcon Symbol="Cloud24"
                                                           FontSize="14"
                                                           Margin="0,0,4,0"/>
                                            <TextBlock Text="{Binding CloudProvider}"
                                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                       FontSize="12"
                                                       Margin="0,0,6,0"/>
                                            <ui:Button Click="OnCloudUrlClick"
                                                       Appearance="Transparent"
                                                       Padding="4,2"
                                                       Cursor="Hand">
                                                <TextBlock Text="{Binding CloudUrl}"
                                                           Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}"
                                                           TextDecorations="Underline"
                                                           TextTrimming="CharacterEllipsis"
                                                           MaxWidth="200"
                                                           FontSize="12"/>
                                            </ui:Button>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Action Buttons -->
                                    <StackPanel Grid.Column="2"
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center"
                                                helpers:StackPanelHelper.Spacing="8">
                                        <!-- Upload Button (if not uploaded) -->
                                        <ui:Button Click="OnUploadClick"
                                                   Icon="ArrowUpload24"
                                                   Content="Upload"
                                                   Visibility="{Binding CloudUrl, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}"/>

                                        <!-- Delete Button -->
                                        <ui:Button Click="OnDeleteClick"
                                                   Icon="Delete24"
                                                   Appearance="Danger"
                                                   ToolTip="Delete"/>
                                    </StackPanel>
                                </Grid>
                            </ui:Card>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>
    </Grid>
</ui:FluentWindow>
